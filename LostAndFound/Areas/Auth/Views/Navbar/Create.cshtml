@model NavbarViewModel
@{
    ViewData["Title"] = "Add Navbar Item";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Style{
    <style>
        .redStar {
            color: red;
        }
    </style>
}

<div class="card" style="width: 100%;">
    <div class="card-body">
        <div class="row">
            <div class="col-8">
                <h5 class="card-title" style="color: black; font-weight:bold">Create Navbar Item</h5>
            </div>
            <div class="col-4">
                <a class="btn btn-success btn-sm ml-2" id="backBtn" style="float:right; color:white">&nbsp; &nbsp; Back &nbsp; &nbsp;</a>
            </div>
        </div>
        <hr>
        <div class="container">
            <form asp-area="HRPMSEmployee" asp-controller="Navbar" asp-action="Create" method="post" data-parsley-validate="parsley">

                <div asp-validation-summary="All" class="text-danger"></div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="nameOption" class="col-sm-4 col-form-label">Name Option <span style="float:right;" class="redStar">*</span></label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="nameOption" name="nameOption" data-parsley-required="true">
                                <input type="hidden" name="Id" id="Id" value="0" />
                            </div>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="form-group row">
                            <label for="nameOptionBangla" class="col-sm-4 col-form-label">Name Option (Bangla) </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="nameOptionBangla" name="nameOptionBangla">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="area" class="col-sm-4 col-form-label">Area </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="area" name="area">
                            </div>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="form-group row">
                            <label for="controller" class="col-sm-4 col-form-label">Controller </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="controller" name="controller">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="action" class="col-sm-4 col-form-label">Action </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="action" name="action">
                            </div>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="form-group row">
                            <label for="imageClass" class="col-sm-4 col-form-label">Image Class </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="imageClass" name="imageClass">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="moduleId" class="col-sm-4 col-form-label">Module <span style="float:right;" class="redStar">*</span></label>
                            <div class="col-sm-8">
                                <select class="form-control" id="moduleId" name="moduleId" data-parsley-required="true">
                                    <option value="">Select</option>
                                    @foreach (var item in Model.ERPModules)
                                    {
                                        <option value="@item.Id">@item.moduleName</option>
                                    }
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="form-group row">
                            <label for="activeLi" class="col-sm-4 col-form-label">Active Li </label>
                            <div class="col-sm-8">
                                <input type="text" class="form-control" id="activeLi" name="activeLi">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="isParent" class="col-sm-4 col-form-label">Category <span style="float:right;" class="redStar">*</span></label>
                            <div class="col-sm-8">
                                <select class="form-control" id="isParent" name="isParent" data-parsley-required="true">
                                    <option value="">Select</option>
                                    <option value="2">Child</option>
                                    <option value="1">Band</option>
                                    <option value="0">Parent</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="form-group row">
                            <label for="status" class="col-sm-4 col-form-label">Status <span style="float:right;" class="redStar">*</span></label>
                            <div class="col-sm-8">
                                <select class="form-control" id="status" name="status" data-parsley-required="true">
                                    <option value="True">Active</option>
                                    <option value="False">Inactive</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-6">
                        <div class="form-group row">
                            <label for="parentID" class="col-sm-4 col-form-label">Parent ID </label>
                            <div class="col-sm-8">
                                <select class="form-control" id="parentID" name="parentID">
                                    <option value="0">Select</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="col-6">
                        <div class="form-group row">
                            <label for="displayOrder" class="col-sm-4 col-form-label">Display Order </label>
                            <div class="col-sm-8">
                                <input data-parsley-type="number" class="form-control" id="displayOrder" name="displayOrder">
                            </div>
                        </div>
                    </div>

                    <div class="col-6" id="bandSelect">
                        <div class="form-group row">
                            <label for="parentID" class="col-sm-4 col-form-label">Band ID </label>
                            <div class="col-sm-8">
                                <select class="form-control" id="bandID" name="bandID">
                                    <option value="0">Select</option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>

                <hr />
                <button type="submit" value="Submit" class="btn btn-success" style="float:right; margin-top:5px;">Save</button>

            </form>
        </div>
    </div>
</div>

<br />
<br />

<div class="row clearfix">
    <div class="col-12">
        <div class="card mb-4">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h5 style="color: black; font-weight:bold">Navbar Item List</h5>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <table class="table table-striped table-bordered" id="navbarItemTable">
                    <thead>
                        <tr>
                            <th>Name Option</th>
                            <th>Module</th>
                            <th>isParent</th>
                            <th>Parent</th>
                            <th>Status</th>
                            <th>Area</th>
                            <th>Controller</th>
                            <th>Operation</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var data in Model.navbars)
                        {
                            <tr>
                                <td>@data.nameOption</td>
                                <td>@data.module?.moduleName</td>
                                @if (@data.isParent == 0)
                                {
                                    <td>Parent</td>
                                }
                                else if (@data.isParent == 1)
                                {
                                    <td>Band</td>
                                }
                                else
                                {
                                    <td>Child</td>
                                }
                                <td>@data.parentName</td>
                                <td>@data.status</td>
                                <td>@data.area</td>
                                <td>@data.controller</td>
                                <td>
                                    <a class="btn btn-success" onclick="Edit(@data.Id, '@data.nameOption', '@data.nameOptionBangla', '@data.moduleId','@data.area','@data.controller','@data.action','@data.imageClass','@data.activeLi','@data.status','@data.isParent','@data.parentID','@data.displayOrder')" href="#"><i class="fa fa-edit"></i></a>
                                    @*<a class="btn btn-danger" onclick="Remove(@data.Id)" href="#"><i class="fa fa-trash-alt"></i></a>*@
                                </td>
                            </tr>
                        }

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>
        var parId = 0;
        var mdlId = 0;
        $(document).ready(function () {

            var modelId = window.localStorage.getItem('modelId');
            var parentId = window.localStorage.getItem('parentId');

            if (modelId != null) {
                $("#backBtn").prop('href', '/Home/GridMenuPage?moduleId=' + modelId + '&perentId=' + parentId);
            } else {
                $("#backBtn").prop('href', '/');
            }

            //$("#bankInfo").addClass("active");
            $('#navbarItemTable').DataTable();
            $('#bandSelect').hide();

            $("#moduleId").change(function () {
                var id = $(this).val();
                var isParent = $("#isParent").val();
                if (isParent == 2) {
                    isParent = 1
                }
                else if (isParent == 1) {
                    isParent = 0
                }
                else if (isParent == 0) {
                    isParent = 9
                }
                Common.Ajax('GET', '/global/api/getNavbarItemByParentByModule/' + id + '/' + isParent, [], 'json', ajaxNavbarParents, false);
            });

            $("#isParent").change(function () {
                var id = $("#moduleId").val();
                var isParent = $("#isParent").val();
                if (isParent == 2) {
                    isParent = 0;
                    $('#bandSelect').show();
                }
                else if (isParent == 1) {
                    isParent = 0;
                    $('#bandSelect').hide();
                }
                else if (isParent == 0) {
                    isParent = 9;
                    $('#bandSelect').hide();
                }
                Common.Ajax('GET', '/global/api/getNavbarItemByParentByModule/' + id + '/' + isParent, [], 'json', ajaxNavbarParents, false);
            });

            $("#parentID").change(function () {
                var id = $("#moduleId").val();
                var isParent = $("#parentID").val();
                //alert(id +" " + " "+ isParent);
                Common.Ajax('GET', '/global/api/GetNavbarItemByParentIdByModule/' + id + '/' + isParent, [], 'json', ajaxNavbarParentsforChild, false);
            });


        });

        function ajaxNavbarParents(response) {
            var options = '<option value="0">Select</option>';
            $.each(response, function (i, item) {
                options += '<option value="' + item.Id + '">' + item.nameOption + '</option>';
            });
            $('#parentID').empty();
            $('#parentID').append(options);
        }

        function ajaxNavbarParentsforChild(response) {
            //console.log(response);
            var options = '<option value="0">Select</option>';
            $.each(response, function (i, item) {
                options += '<option value="' + item.Id + '">' + item.nameOption + '</option>';
            });
            $('#bandID').empty();
            $('#bandID').append(options);
        }

        function Edit(Id, nameOption, nameOptionBangla, moduleId, area, controller, action, imageClass, activeLi, status, isParent, parentID, displayOrder) {
            $("#Id").val(Id);
            $("#nameOption").val(nameOption);
            $("#nameOptionBangla").val(nameOptionBangla);
            $("#area").val(area);
            $("#controller").val(controller);
            $("#action").val(action);
            $("#imageClass").val(imageClass);
            $("#activeLi").val(activeLi);
            $("#status").val(status);
            $("#displayOrder").val(displayOrder);

            $("#moduleId").val(moduleId);
            $("#isParent").val(isParent);
            var category = isParent;
            if (category == 2) {
                category = 0;
                $('#bandSelect').show();
            }
            else if (category == 1) {
                $('#bandSelect').hide();
                category = 0;
                Common.Ajax('GET', '/global/api/getNavbarItemByParentByModule/' + moduleId + '/' + category, [], 'json', ajaxNavbarParents, false);
                $("#parentID").val(parentID);
                return false;
            }
            else if (category == 0) {
                $('#bandSelect').hide();
                category = 9;
                return false;
            }
            Common.Ajax('GET', '/global/api/getNavbarItemByParentByModule/' + moduleId + '/' + category, [], 'json', ajaxNavbarParents, false);
            parId = parentID;
            mdlId = moduleId;
            Common.Ajax('GET', '/global/api/GetNavbarParentIdById/' + parentID, [], 'json', ajaxGetNavbarParentIdById, false);
        }

        function ajaxGetNavbarParentIdById(response) {
            $("#parentID").val(response);
            Common.Ajax('GET', '/global/api/GetNavbarItemByParentIdByModule/' + mdlId + '/' + response, [], 'json', ajaxNavbarParentsforChild, false);
            $("#bandID").val(parId);
        }

        function Remove(Id) {
            chk = confirm('Do you want to delete this?');
            if (chk) {
                location.replace("/ERPSettings/Navbar/Delete/" + Id);
            } else {
                return false;
            }
        }

    </script>
}
